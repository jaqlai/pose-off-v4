<!doctype html>
<html lang="em">
<head>
    <meta charset="UTF-8">
    <title>Pose Off!</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.2"></script>
    <!-- Load BodyPix -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0"></script>
</head>

<body>
<div id="main">
    <img id="streamImg">
    <canvas id = "streamCanvas"></canvas>
    <canvas id = "diffCanvas"></canvas>
    <canvas id = "drawCanvas"></canvas>
    <div id="vidContainer" style="display:none">
    <video id="myVid" autoplay playsinline style="display:none"></video>
</div>

</div>
<div id="dashboard">
    <p>Status: <span id="userMessage">Click to the left to activate your webcam.</span></p>
    <div id="statsDiv" hidden>
        <p>FPS: <span id="fps"></span></p>
    </div>
    <div id="controls">

        <!-- <p>Trade off speed for accuracy:</p>
        <button id="highSpeed" disabled>Faster</button>
        <button id="normalSpeed" disabled>Normal</button>
        <button id="lowerSpeed" disabled>More accurate</button>
        <button id="lowSpeed" disabled>Most accurate</button> -->

        <button id="reset">Exit / Restart</button>
    </div>
</div>

<!-- messages stuff-->
<!-- <ul id="messages"></ul>
<form action="">
    <input id="m" autocomplete="off" /><button>Send</button>
</form> -->


<!-- include socket and jquery -->
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://bundle.run/pixelmatch@5.0.1"></script>

<!-- socket stuff -->
<script>
var thisRoom;
var socket = io();
$(function () {
    if (location.hash) {
        //should this convert so that it will still work if the hash is messed with?
        thisRoom = location.hash;
        socket.emit('room-hash', thisRoom);
        
        //document.getElementById("room-display").innerHTML = "Current Room: "+location.hash;
    };

    // $('form').submit(function(e){
    //     e.preventDefault(); // prevents page reloading
    //     socket.emit('chat message', $('#m').val());
    //     $('#m').val('');
    //     return false;
    // });
    // socket.on('chat message', function(msg){
    //      $('#messages').append($('<li>').text(msg));
    // });

    socket.on('seg-stream', (data) => {
        $('#streamImg').attr('src',data);
        // //console.log("wooho");
        // var canvas = document.getElementById("streamImg");
        // var ctx = canvas.getContext("2d");
        // //console.log(ctx);
        // ctx = data;
        // console.log("hahah");
    });

// compare the two images
    function foo() {
    socket.emit('run-match', drawCanvas.toDataURL('image/webp'));
    // console.log("lmfao");
    setTimeout(foo, 100);
    }

    foo();
});
</script>

<script src="/js/ui-helper.js"></script>
<script src="/js/scan.js"></script>

<!-- <script src="/js/output.js"></script> -->

</body>
</html>
